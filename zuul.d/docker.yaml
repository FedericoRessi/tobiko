---

- project-template:
    name: tobiko-docker
    description: |
      Docker jobs intended to gate Tobiko container related changes
    check: &CHECK
      jobs:
        - tobiko-docker
        - tobiko-docker-fedora
        - tobiko-docker-functional
        - tobiko-docker-infrared
        - tobiko-docker-linters
        - tobiko-docker-lower-constraints
    gate:
      jobs:
        - tobiko-docker-functional
    periodic: *CHECK


# ----------------------------------------------------------------------------

- job:
    name: tobiko-docker
    description: |
      Run unit tests for an OpenStack Python project inside a Docker container.
    voting: true
    parent: base
    timeout: 2400
    pre-run: playbooks/docker/pre.yaml
    run: playbooks/docker/run.yaml
    post-run: playbooks/docker/post.yaml
    # post-run: playbooks/docker/post.yaml
    vars:
        docker_compose_service: unit


- job:
    name: tobiko-docker-fedora
    description: |
      Run functional tests for an OpenStack Python project inside a Docker container
      based on Fedora 35
    voting: true
    parent: tobiko-docker
    vars:
        docker_compose_service: fedora


- job:
    name: tobiko-docker-functional
    description: |
      Run functional tests for an OpenStack Python project inside a Docker container.
    voting: true
    parent: tobiko-docker
    timeout: 3600
    vars:
        docker_compose_service: functional


- job:
    name: tobiko-docker-infrared
    description: |
      Run functional tests for an OpenStack Python project inside a Docker container.
    voting: true
    parent: tobiko-docker
    timeout: 3600
    vars:
        docker_compose_service: infrared


- job:
    name: tobiko-docker-linters
    description: |
      Run static analisys verifications
    voting: true
    parent: tobiko-docker
    vars:
        docker_compose_service: linters


- job:
    name: tobiko-docker-lower-constraints
    description: |
      Run functional tests for an OpenStack Python project inside a Docker container
      with lower-constrains.txt requirements file.
    voting: true
    parent: tobiko-docker
    vars:
        docker_compose_service: lower-constraints
